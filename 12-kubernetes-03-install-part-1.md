# Домашняя работа по занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

> ## Задание 1: Описать требования к кластеру
> Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:  
> * база данных должна быть отказоустойчивой (не менее трех копий, master-slave) и потребляет около 4 ГБ ОЗУ в работе;
> * кэш должен быть аналогично отказоустойчивый, более трех копий, потребление: 4 ГБ ОЗУ, 1 ядро;
> * фронтенд обрабатывает внешние запросы быстро, отдавая статику: не более 50 МБ ОЗУ на каждый экземпляр;
> * бекенду требуется больше: порядка 600 МБ ОЗУ и по 1 ядру на копию.
>
> Требования: опишите, сколько нод в кластере и сколько ресурсов (ядра, ОЗУ, диск) нужно для запуска приложения. Расчет вести из необходимости запуска 5 копий фронтенда и 10 копий бекенда, база и кеш.

Общее количество ресурсов, необходимых для работы Приложения:

Компонент | CPU | Memory | Количество | CPU total | Memory total
---: | ---: | ---: | ---: | ---: | ---: 
База данных | 1 | 4 | 3 | 3 | 12
Кэш | 1 | 4 | 3 | 3 | 12 
Фронтэнд | 0.1 | 0.05 | 5 | 0.5 | 0.25
Бэкэнд | 1 | 0.6 | 10 | 10 | 6

Всего для Приложения нам нужно ресуров: 
* CPU: (3 + 3 + 0.5 + 10) = 16,5 ≈ 17
* Memory: (12 + 12 + 0.25 + 6) = 30.25 ≈ 31

Допустим, в целях производительности/отказоусточивости мы хотим три рабочие ноды. Тогда на каждую из них придётся примерно треть 
требуемых ресурсов. Но вдруг одна нода сломается? тогда ресурсы с неё должны быть перераспределены между двумя выжившими, 
и мы должны оставить необходимый запас.  
Итак, на каждой ноде мы должны зарезервировать на нужды Приложения:
* CPU: (17 / 3) + (17 / 3 / 2) = 8,5 ≈ 9
* Memory: (31 / 3) + (31 / 3 / 2) = 15.5 ≈ 16 

Добавим ресурсы для системных нужд рабочей ноды Кубернетеса:
* CPU: 9 + 1 = 10
* Memory: 16 + 1 = 17

Но, если это не виртуалки, серверов с такими некруглыми количествами процессоров вряд ли найти. Допустим, мы возьмём 
сервера с двумя Xeon E5-2620v3, и отключим гипертрединг, одно горе от него. Тогда получим 2CPU * 6cores = 12, и ещё 
поставим 24 Гб памяти, если получится распределить такое не совсем круглое число, но это в зависимости от модели сервера. 
А ещё лучше взять 32Гб, будет "на вырост". Наверняка же бизнес пойдёт в гору и требования к Приложению возрастут!  

И ещё нам надо будет откуда-нибудь взять Control Plane для нашего кластера. 2 CPU, 2Гб. Больше одной управляющей ноды 
брать смысла нет, и кластер небольшой, и по условиям задачи отказоустойчивости для неё не заказано. 

А ещё можно было бы на каждом сервере нарезать по две виртуалочки с необходимыми ресурсами, одну из которых сделать рабочей нодой, 
другую управляющей. Вот тогда бы была полная отказоустойчивость.
